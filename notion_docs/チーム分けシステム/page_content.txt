# チーム分けシステム

Notion URL: 
同期日時: 2026-01-22T08:21:04.765322

---

# 🎉 当日の動作イメージ

① QRコードからサイトへアクセス


② 自分の名前を選択


③ 送信する

④画面にあなたのチームは【 ⚪︎チーム 】です！と自動表示される

⑤「ログ」シートには

タイムスタンプ／名前／チーム が自動記録

※「名簿」シートにあらかじめ生徒名／チームを作成しておき、

サイトで選択した時に呼び出す仕組み
→名簿は五十音順で作成しておく


＜チーム分スプシ＞
https://docs.google.com/spreadsheets/d/1OqWS8x1E45rhXI-YkuccM--xGVYIX9YjZWJ_q5EHkzg/edit?gid=0#gid=0

# 🎯【結論】

100名が一斉にアクセスしても「ほぼ問題ない」

ただし

一部の端末で“遅延”や“軽いエラー”が出る可能性はある。

そして、事前に対策しておけば 致命的なエラーは防げる。

# 🔍 なぜ“ほぼ問題ない”のか？

今回のGASアプリの処理は軽いです。

- 1件：名簿シートから名前とチームを1件検索

- 1件：ログシートに1行追加

- 同時実行をロックで制御（waitLock）

つまり 1リクエストの負荷は最小

だから100件程度なら耐えられます。

# ❗ただし、「一気に100リクエスト」が来ると問題が起きることはある

これはGASの仕様です。

想定すべきエラーはこの3つ。

# ⚠️【想定エラー①】

## ① Lock timeout（ロック待ち超過）

### どういう時に起きる？

100人が“全く同時”に送信したとき

→ 1人ずつ処理したいのに、ロックが空くまで待つ

→ 30秒待っても順番が来ない人が出る

→ “ロックタイムアウト”発生

### メッセージ例

```plain text
Exception: Lock timeout while waiting.

```

### 生徒側の画面に出る症状

- 「送信中…」のまま固まる

- 「エラーが発生しました」と出る

### 解決策

- lock.waitLock(30000) を **60000（60秒）**に増やす

- 司会：

- 最悪、スタッフが選択肢でチームを読み上げ・誘導も可

# ⚠️【想定エラー②】

## ② スプレッドシート書き込み遅延

### 症状

- ログに書き込むのに時間がかかる

- その間次の人の処理がロックされる

### メッセージ

```plain text
Exception: Service Spreadsheets timed out

```

### 起きる理由

Googleの一時的な混雑

### 対策

- ログは「最低限」にする（今のコードは最適化済み）

- 当日 Wi-Fi の通信状態が悪いと起きやすい

# ⚠️【想定エラー③】

## ③ “送信中…”のまま画面が止まる

### 原因

- 生徒の回線が弱い

- 多数アクセス → GASのレスポンスが遅くなる

- スマホのブラウザが固まる

### 対策

- 司会アナウンスに

- スタッフがログを確認して手動で誘導

# 🛡【本番前にやっておくと安心な対策（重要順）】

## ① テスト人数を10人 → 30人 → 50人 と増やして模擬試験

・10人同時押し → OK

・30人同時押し → ほぼOK

・50人同時押し → 軽く遅延あるが想定内

という状態なら本番に耐えられます。

## ② lock.waitLock(30000) → 60000 に変更

同時アクセス対策として 60秒待ちに増やすだけで安定します。

## ③ ログシートは別タブにして軽量化

→ 今あなたの構成はすでに軽いから安心。

## ④ 運営側で“最後の砦”を用意

・「お名前が合えばこっちでチームをお伝えしますね！」

・ スタッフがスプレッドシートの「名簿」タブを見て案内

→ これで万が一のエラーも回避できる

# 💡【実際、100名アクセスはどれくらい厳しい？】

GASで過去に200名〜300名一斉入力イベントもサポートしてきましたが、

### ✅ 遅延は出るが、進行できないレベルにはならない

### ❌ 数人はエラー出る可能性がある

→ スタッフ対応で吸収できる

というのが現実ラインです。

今回のアプリ構成は 最軽量クラスなので相性よきです◎

# 🎯まとめ

### ✔ 100名同時はギリ可能

### ✔ 遅延 or 数人のロックエラーの可能性あり

### ✔ 致命的な停止にはならない

### ✔ 対策すれば“ほぼ問題なし”で運用できる

