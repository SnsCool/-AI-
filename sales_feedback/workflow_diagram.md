# 営業フィードバックエージェント ワークフロー

## メインフロー

```
┌─────────────────────────────────────────┐
│          ワークフロー1: 入力            │
│                                         │
│  議事録テキスト / 音声 / 動画          │
│  + メタデータ（担当者、顧客、業種）     │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│        ワークフロー2: 前処理            │
│                                         │
│  【テキストの場合】                     │
│   → そのまま次へ                       │
│                                         │
│  【音声/動画の場合】                    │
│   → AssemblyAI で文字起こし            │
│   → 話者分離（営業 vs 顧客）           │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│         ワークフロー3: 分析             │
│                                         │
│  Gemini API で営業スキル評価           │
│                                         │
│  評価項目（各1-5点）:                   │
│   ├─ ヒアリング力                      │
│   ├─ 提案力                            │
│   ├─ 異議対応                          │
│   ├─ クロージング                      │
│   ├─ ラポール構築                      │
│   └─ BANT確認                          │
│                                         │
│  出力:                                  │
│   ├─ スコア                            │
│   ├─ 良かった点                        │
│   ├─ 改善点                            │
│   └─ アドバイス                        │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│         ワークフロー4: 保存             │
│                                         │
│  【全件】                               │
│   → Google Drive にレポート保存        │
│                                         │
│  【成功事例のみ】                       │
│   → Notion にナレッジとして蓄積        │
│                                         │
│  【通知】                               │
│   → Slack で担当者に通知              │
└─────────────────────────────────────────┘
```

---

## シンプル版

```
ワークフロー1: 入力
  │ 議事録/音声をアップロード
  │ メタデータを入力
  ▼
ワークフロー2: 前処理
  │ 音声→テキスト変換（AssemblyAI）
  │ 話者分離
  ▼
ワークフロー3: 分析
  │ Gemini で営業スキル評価
  │ フィードバック生成
  ▼
ワークフロー4: 保存・通知
  │ Drive: レポート保存
  │ Notion: ナレッジ蓄積（成功事例）
  │ Slack: 通知
  ▼
  完了
```

---

## 各ワークフローの詳細

### ワークフロー1: 入力

```
入力方法:
  ├─ 手動実行（GitHub Actions）
  │    └─ 議事録URL or テキスト直接入力
  │
  ├─ Webhook（Zoom連携）
  │    └─ 会議終了時に自動トリガー
  │
  └─ 定期実行
       └─ 日次で未処理の議事録を一括処理

必要なパラメータ:
  ├─ transcript: 議事録（URL or テキスト）
  ├─ sales_rep: 営業担当者名
  ├─ customer: 顧客名
  ├─ industry: 業種
  ├─ product: 商材
  └─ is_closed: クロージング成功フラグ
```

### ワークフロー2: 前処理

```
処理フロー:
  入力タイプ判定
       │
       ├─【テキスト】─→ そのまま分析へ
       │
       └─【音声/動画】
              │
              ▼
         ┌─────────────────┐
         │   AssemblyAI    │
         │                 │
         │ ・文字起こし    │
         │ ・話者分離      │
         │ ・タイムスタンプ│
         └─────────────────┘
              │
              ▼
         テキスト化完了
```

### ワークフロー3: 分析

```
Gemini API 呼び出し:

  入力:
    ├─ 議事録テキスト
    └─ 評価プロンプト

  処理:
    ┌────────────────────────────────┐
    │   営業スキル評価（6項目）      │
    │                                │
    │ 1. ヒアリング力 ─→ X/5点       │
    │ 2. 提案力 ─────→ X/5点       │
    │ 3. 異議対応 ───→ X/5点       │
    │ 4. クロージング → X/5点       │
    │ 5. ラポール構築 → X/5点       │
    │ 6. BANT確認 ───→ X/5点       │
    │                                │
    │ 総合スコア ────→ X.X/5.0     │
    └────────────────────────────────┘

  出力:
    {
      "overall_score": 3.8,
      "scores": {...},
      "good_points": [...],
      "improvements": [...],
      "key_phrases": [...],
      "advice": [...]
    }
```

### ワークフロー4: 保存・通知

```
保存先:
  ┌─────────────────────────────────┐
  │        Google Drive             │
  │                                 │
  │  📁 sales_feedback/             │
  │     └─ 2025-01-15_ABC社.md     │
  │                                 │
  │  内容: 詳細レポート             │
  └─────────────────────────────────┘
              │
              ▼（成功事例の場合）
  ┌─────────────────────────────────┐
  │          Notion                 │
  │                                 │
  │  📊 sales_knowledge DB          │
  │     ├─ 日付                    │
  │     ├─ 担当者                  │
  │     ├─ 顧客                    │
  │     ├─ 業種                    │
  │     ├─ スコア                  │
  │     ├─ 成功要因                │
  │     └─ 効果的フレーズ          │
  └─────────────────────────────────┘
              │
              ▼
  ┌─────────────────────────────────┐
  │           Slack                 │
  │                                 │
  │  #sales-feedback               │
  │  ┌───────────────────────────┐ │
  │  │ 🎯 商談フィードバック     │ │
  │  │ 担当: 山田                │ │
  │  │ スコア: 3.8/5.0          │ │
  │  │ ✅ 良: ヒアリングが丁寧   │ │
  │  │ 📈 改: クロージング強化   │ │
  │  └───────────────────────────┘ │
  └─────────────────────────────────┘
```

---

## トリガー別フロー

### 手動実行

```
担当者
  │
  │ GitHub Actions で手動実行
  │ (議事録URL + メタデータ入力)
  ▼
ワークフロー1
  ▼
ワークフロー2
  ▼
ワークフロー3
  ▼
ワークフロー4
  │
  ▼
Slack通知 → 担当者
```

### Zoom Webhook連携

```
Zoom会議終了
  │
  │ Webhook → GitHub repository_dispatch
  ▼
ワークフロー1 (録画URL自動取得)
  ▼
ワークフロー2 (自動文字起こし)
  ▼
ワークフロー3
  ▼
ワークフロー4
  │
  ▼
Slack通知 → 担当者
```

---

## 必要な環境変数（GitHub Secrets）

```
# AI分析
GEMINI_API_KEY          # Gemini API キー

# 音声文字起こし
ASSEMBLYAI_API_KEY      # AssemblyAI API キー

# Google連携
GCP_SA_KEY_JSON               # サービスアカウントJSON
SALES_FEEDBACK_DRIVE_FOLDER_ID # 保存先フォルダID

# Notion連携
NOTION_TOKEN            # Notion API トークン
SALES_KNOWLEDGE_DB_ID   # ナレッジDBのID

# Slack連携
SLACK_BOT_TOKEN              # Slack Bot トークン
SALES_FEEDBACK_CHANNEL_ID    # 通知チャンネルID
```
