# Sales Feedback Agent（営業フィードバックエージェント）仕様書

## 1. 概要

### 1.1 目的
Zoom営業会議の議事録・録画を分析し、営業担当者にフィードバックを提供するエージェント。
クロージング成功事例をナレッジとして蓄積し、チーム全体の営業力向上を支援する。

### 1.2 エージェント分類
- **タイプ**: judgment（判断系）
- **エージェント名**: `sales_feedback`
- **役割**: 営業会議の分析・評価・フィードバック生成

---

## 2. 機能要件

### 2.1 入力データ対応

| 入力形式 | 説明 | 処理方法 |
|---------|------|---------|
| テキスト議事録 | Zoom/手動作成の議事録 | 直接分析 |
| 音声ファイル | mp3, wav, m4a | Speech-to-Text後に分析 |
| 動画ファイル | mp4, webm | 音声抽出→文字起こし→分析 |
| Zoom録画URL | クラウド録画リンク | ダウンロード→処理 |

### 2.2 分析機能

#### A. 会話分析
- **話者分離**: 営業担当 vs 顧客の発言を識別
- **発話比率**: 営業側/顧客側の発話時間・量を計測
- **質問分析**: 質問の数・質・タイミングを評価
- **傾聴度**: 顧客の話を遮っていないかチェック

#### B. 営業スキル評価

| 評価項目 | 評価基準 |
|---------|---------|
| ヒアリング力 | 課題・ニーズを引き出せているか |
| 提案力 | 顧客課題に対する解決策を適切に提示 |
| 異議対応 | 顧客の懸念・反論への対応品質 |
| クロージング | 次のアクション・契約への導き方 |
| ラポール構築 | 信頼関係の構築度合い |
| BANT確認 | Budget/Authority/Need/Timelineの確認 |

#### C. フィードバック生成
- **良かった点**: 具体的な発言・行動を引用
- **改善点**: 具体的な改善提案と代替案
- **スコアリング**: 各項目を5段階評価
- **総合評価**: 全体サマリーと優先改善ポイント

### 2.3 ナレッジ蓄積機能

#### クロージング成功事例の蓄積
```
【蓄積データ】
- 商談概要（業種、商材、商談フェーズ）
- 成功要因の分析結果
- 効果的だったフレーズ・対応
- 顧客の反応パターン
- 担当者・チーム
- 日時
```

#### ナレッジ検索・活用
- 類似商談の成功事例を検索
- 業種・商材別のベストプラクティス抽出
- 担当者別の強み・改善傾向分析

---

## 3. 必要なAPI

### 3.1 音声・動画処理

| API | 用途 | 料金目安 |
|-----|------|---------|
| **Google Cloud Speech-to-Text** | 音声文字起こし | $0.006/15秒 |
| **OpenAI Whisper API** | 高精度文字起こし | $0.006/分 |
| **AssemblyAI** | 話者分離付き文字起こし | $0.00025/秒 |

**推奨**: AssemblyAI（話者分離機能が標準搭載）

### 3.2 AI分析

| API | 用途 | 既存利用 |
|-----|------|---------|
| **Google Gemini API** | 会話分析・評価生成 | ✅ 利用中 |
| **Claude API** | 高度な文脈理解（オプション） | - |

### 3.3 データ連携

| API | 用途 | 既存利用 |
|-----|------|---------|
| **Zoom API** | 録画取得・会議情報取得 | ❌ 新規 |
| **Google Drive API** | ファイル保存・取得 | ✅ 利用中 |
| **Notion API** | ナレッジ保存 | ✅ g04_apiで利用中 |
| **Qdrant** | ベクトル検索 | ✅ g04_apiで利用中 |

### 3.4 通知・出力

| API | 用途 | 既存利用 |
|-----|------|---------|
| **Slack API** | フィードバック通知 | ✅ g04_apiで利用中 |
| **Google Sheets API** | 評価データ集計 | ✅ 利用中 |

---

## 4. システム構成

### 4.1 アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────────┐
│                        Input Sources                             │
├─────────────────────────────────────────────────────────────────┤
│  Zoom録画   │  音声ファイル  │  動画ファイル  │  テキスト議事録  │
└──────┬──────┴───────┬────────┴───────┬────────┴────────┬────────┘
       │              │                │                 │
       ▼              ▼                ▼                 │
┌──────────────────────────────────────────┐             │
│         前処理パイプライン                  │             │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  │             │
│  │ダウンロード│→│音声抽出 │→│文字起こし│  │             │
│  │(Zoom API)│  │(FFmpeg)│  │(AssemblyAI)│ │             │
│  └─────────┘  └─────────┘  └─────────┘  │             │
└──────────────────────┬───────────────────┘             │
                       │                                  │
                       ▼                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                   SalesFeedbackAgent                             │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    think()                               │    │
│  │  - 入力タイプ判定                                         │    │
│  │  - 分析スコープ決定                                       │    │
│  │  - 評価基準選択                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                            │                                     │
│                            ▼                                     │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   execute()                              │    │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   │    │
│  │  │会話分析 │→│スキル評価│→│FB生成  │→│保存/通知│   │    │
│  │  │(Gemini)│  │(Gemini) │  │(Gemini)│  │        │   │    │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘   │    │
│  └─────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────────────────────────────────┘
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
┌───────────┐  ┌───────────┐  ┌───────────┐
│   Slack   │  │   Notion  │  │  Qdrant   │
│  (通知)   │  │(ナレッジ) │  │(ベクトル) │
└───────────┘  └───────────┘  └───────────┘
```

### 4.2 データフロー

```
1. 入力受付
   └→ Zoom録画URL / ファイルパス / テキスト

2. 前処理
   └→ 必要に応じて音声抽出・文字起こし

3. 分析実行
   ├→ 会話構造分析（話者・発話量）
   ├→ 営業スキル評価（6項目）
   └→ 成功/失敗要因特定

4. フィードバック生成
   ├→ 良かった点（具体例付き）
   ├→ 改善点（代替案付き）
   └→ スコアカード

5. 出力・保存
   ├→ Slack通知（担当者へ）
   ├→ Notion保存（詳細レポート）
   └→ Qdrant登録（成功事例のみ）
```

---

## 5. 実装計画

### Phase 1: MVP（最小構成）
- [ ] テキスト議事録の分析機能
- [ ] Geminiによる評価・フィードバック生成
- [ ] Google Driveへの結果保存
- [ ] 基本的なスコアリング

### Phase 2: 音声対応
- [ ] AssemblyAI連携（話者分離付き文字起こし）
- [ ] 音声ファイル（mp3/wav）対応
- [ ] 動画ファイル（mp4）対応

### Phase 3: Zoom連携
- [ ] Zoom API連携（録画自動取得）
- [ ] Webhook対応（会議終了時自動トリガー）

### Phase 4: ナレッジ蓄積
- [ ] Notion連携（詳細レポート保存）
- [ ] Qdrant連携（成功事例ベクトル化）
- [ ] 類似事例検索機能

### Phase 5: 高度化
- [ ] Slack通知連携
- [ ] ダッシュボード（Google Sheets集計）
- [ ] チーム分析・ランキング機能

---

## 6. 環境変数（追加が必要）

```env
# 音声文字起こし
ASSEMBLYAI_API_KEY=...

# Zoom連携（Phase 3）
ZOOM_ACCOUNT_ID=...
ZOOM_CLIENT_ID=...
ZOOM_CLIENT_SECRET=...

# 既存（確認用）
GEMINI_API_KEY=...
GOOGLE_DRIVE_FOLDER_ID=...
NOTION_TOKEN=...
QDRANT_URL=...
SLACK_BOT_TOKEN=...
```

---

## 7. エージェント能力定義

```python
class SalesFeedbackAgent(BaseAgent):
    @property
    def name(self) -> str:
        return "sales_feedback"

    @property
    def description(self) -> str:
        return "営業フィードバックエージェント - Zoom会議を分析しフィードバック生成"

    @property
    def agent_type(self) -> str:
        return "judgment"

    def get_capabilities(self) -> list[str]:
        return [
            "analyze_sales_meeting",      # 営業会議分析
            "transcribe_audio",           # 音声文字起こし
            "evaluate_sales_skills",      # 営業スキル評価
            "generate_feedback",          # フィードバック生成
            "store_knowledge",            # ナレッジ蓄積
            "search_best_practices",      # ベストプラクティス検索
        ]

    def can_handle(self, request: str) -> bool:
        keywords = [
            "営業", "商談", "会議", "議事録", "zoom",
            "フィードバック", "評価", "分析", "クロージング",
            "ナレッジ", "成功事例"
        ]
        return any(kw in request.lower() for kw in keywords)
```

---

## 8. 評価プロンプト（Gemini用）

```
あなたは経験豊富な営業マネージャーです。
以下の営業会議の議事録を分析し、営業担当者へのフィードバックを生成してください。

【評価項目】
1. ヒアリング力（1-5点）
   - 顧客の課題・ニーズを適切に引き出せているか

2. 提案力（1-5点）
   - 課題に対する解決策を適切に提示できているか

3. 異議対応（1-5点）
   - 顧客の懸念・反論に適切に対応できているか

4. クロージング（1-5点）
   - 次のアクションへ適切に導けているか

5. ラポール構築（1-5点）
   - 信頼関係を構築できているか

6. BANT確認（1-5点）
   - Budget/Authority/Need/Timelineを確認できているか

【出力形式】
JSON形式で以下を出力してください：
{
  "scores": {
    "hearing": {"score": 4, "reason": "..."},
    "proposal": {"score": 3, "reason": "..."},
    ...
  },
  "good_points": ["良かった点1", "良かった点2"],
  "improvements": ["改善点1", "改善点2"],
  "key_phrases": ["効果的だったフレーズ"],
  "overall_score": 3.5,
  "summary": "総合評価コメント"
}
```

---

## 9. 想定コスト（月額目安）

| サービス | 月間利用想定 | 料金目安 |
|---------|------------|---------|
| AssemblyAI | 50時間/月 | ~$45 |
| Gemini API | 1000リクエスト/月 | ~$10 |
| Qdrant Cloud | 1GB | ~$25 |
| Notion | 既存プラン | $0 |
| **合計** | | **~$80/月** |

---

## 10. 次のステップ

1. **仕様確認**: この仕様書の内容を確認・修正
2. **Phase 1実装**: テキスト議事録分析のMVP実装
3. **テスト**: サンプル議事録でテスト
4. **Phase 2以降**: 段階的に機能拡張

---

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-12-30 | 0.1.0 | 初版作成 |
